# 量化闭环系统 Alpha 增强版 - 产品需求文档 (PRD)

**版本**: V9.1 Alpha Enhancement  
**日期**: 2026-02-13  
**作者**: 量化交易顶级交易员 & 产品经理  
**目标**: 将个人量化系统提升至准机构级水平

---

## 一、产品愿景与战略定位

### 1.1 核心问题

**现状分析**：
- ✅ 系统已有完整的9阶段交易闭环
- ✅ 信号生成、验证、执行流程清晰
- ❌ **无法验证是否真正产生超额收益（Alpha）**
- ❌ 信号质量无法量化追踪（胜率、盈亏比）
- ❌ 风险指标不完整（缺少VaR/CVaR）
- ❌ 执行成本未优化（只有市价单）

**痛点**：
1. **交易员视角**："我赚的钱是Alpha还是跟着大盘涨的Beta？"
2. **产品视角**："如何向用户证明系统的价值？"
3. **风控视角**："极端行情下会亏多少？"

### 1.2 产品目标

**北极星指标**：
- Alpha（vs SPY）≥ 5% 年化
- 信号胜率 ≥ 55%
- Sharpe Ratio ≥ 1.5
- VaR(95%) < 2%

**成功标准**：
- 用户能清晰看到自己的Alpha和Beta
- 用户能实时了解每个信号的历史胜率
- 用户能看到投资组合的真实风险敞口

---

## 二、核心功能设计

### 2.1 Alpha/Beta 性能分析仪表盘

**功能价值**：让用户清晰知道自己的超额收益来源

#### 2.1.1 功能需求

**FR-01: Alpha/Beta 计算引擎**
- 基于CAPM模型计算Alpha和Beta
- 支持多个基准（SPY/QQQ/IWM）
- 最小数据要求：5个交易日
- 更新频率：每日收盘后
- 历史回溯：30/90/180/365天

**FR-02: 风险调整收益指标**
- Sharpe Ratio（夏普比率）
- Information Ratio（信息比率）
- Sortino Ratio（索提诺比率）
- Calmar Ratio（卡玛比率）

**FR-03: 基准对比可视化**
- 累计收益率曲线对比（账户 vs 基准）
- 超额收益（Active Return）趋势图
- 跟踪误差（Tracking Error）展示
- Beta 稳定性分析

#### 2.1.2 用户故事

**Story 1**: 作为交易员，我想知道我的收益中有多少是Alpha，有多少是Beta
- **场景**：查看Dashboard，看到"Alpha (vs SPY): +8.5%"
- **价值**：验证策略有效性，不被牛市假象迷惑

**Story 2**: 作为风控人员，我想知道策略的系统性风险暴露
- **场景**：看到"Beta: 0.75"，意味着市场跌10%时预期跌7.5%
- **价值**：合理设置仓位和对冲

#### 2.1.3 交互设计要点

**关键界面**：
```
┌─────────────────────────────────────────┐
│  Alpha 性能分析                          │
├─────────────────────────────────────────┤
│  📊 vs SPY (30天)                       │
│                                          │
│  Alpha        +8.5%  ⬆️ 优秀           │
│  Beta         0.75   🟢 中低风险        │
│  Sharpe       1.82   ⬆️ 优秀           │
│  Info Ratio   1.23   ⬆️ 良好           │
│                                          │
│  📈 累计收益对比                         │
│  ┌─────────────────────────────┐       │
│  │ ⚫ 账户 +15.2%                │       │
│  │ ⚪ SPY +6.7%                  │       │
│  │ 🟢 超额 +8.5%                 │       │
│  └─────────────────────────────┘       │
│                                          │
│  解读: 您的策略产生了显著超额收益,       │
│       风险敞口低于市场,表现优秀。        │
└─────────────────────────────────────────┘
```

**交互规则**：
- 基准切换：SPY/QQQ/IWM下拉选择
- 周期切换：30天/90天/180天/365天标签
- Alpha指标悬浮提示："Alpha = Rp - (Rf + β × (Rm - Rf))"
- 一键导出：PDF格式性能报告

---

### 2.2 信号质量追踪系统

**功能价值**：量化信号效果，持续改进

#### 2.2.1 功能需求

**FR-04: 信号胜率统计**
- 总体胜率（30/90天）
- 按策略分组胜率
- 按信号来源分组胜率
- 按标的分组胜率
- 实时更新已平仓信号

**FR-05: 信号盈亏分析**
- 平均盈利幅度
- 平均亏损幅度
- 盈亏比（Profit/Loss Ratio）
- 期望值（Expectancy）
- 最大连续盈利/亏损

**FR-06: 信号质量评分**
- 信号评估分（0-100）
- 信号新鲜度（生成至执行时长）
- 信号衰减监控
- 置信度校准分析

#### 2.2.2 用户故事

**Story 3**: 作为交易员，我想知道哪个策略的信号最靠谱
- **场景**：看到"动量策略 胜率62% 盈亏比2.3:1"
- **价值**：集中资源在高质量策略上

**Story 4**: 作为系统优化者，我想知道信号是否会衰减
- **场景**：发现"信号半衰期24小时，超时胜率下降15%"
- **价值**：设置合理的信号过期时间

#### 2.2.3 交互设计要点

**关键界面**：
```
┌─────────────────────────────────────────┐
│  信号质量仪表盘                          │
├─────────────────────────────────────────┤
│  📊 整体表现 (30天)                      │
│                                          │
│  信号总数      124                       │
│  已执行        98  (78.9%)               │
│  已平仓        86  (87.8%)               │
│                                          │
│  胜率          58.1%  ⬆️                │
│  盈亏比        2.3:1  ⬆️                │
│  期望值        +1.8%                     │
│                                          │
│  📈 按策略分组                           │
│  ┌─────────────────────────────────┐   │
│  │ 动量策略     62% ⭐⭐⭐⭐⭐      │   │
│  │ 价值策略     54% ⭐⭐⭐⭐        │   │
│  │ 趋势策略     51% ⭐⭐⭐          │   │
│  └─────────────────────────────────┘   │
│                                          │
│  ⚠️ 发现: 价值策略信号衰减较快,建议     │
│           24小时内执行。                 │
└─────────────────────────────────────────┘
```

**交互规则**：
- 点击策略名：展开详细信号列表
- 胜率趋势图：30天滚动窗口
- 筛选器：按日期、策略、标的过滤
- 导出CSV：信号明细数据

---

### 2.3 VaR 风险监控系统

**功能价值**：预知极端行情下的最大损失

#### 2.3.1 功能需求

**FR-07: VaR 计算**
- VaR(95%) - 95%置信度下的在险价值
- VaR(99%) - 99%置信度（极端情形）
- CVaR - 条件在险价值（尾部风险）
- 计算方法：历史模拟法（252天历史数据）

**FR-08: 风险敞口监控**
- 单一标的风险敞口
- 行业集中度风险
- 多空比例监控
- Delta/Gamma 水位预警

**FR-09: 压力测试**
- 2008年金融危机情景
- 2020年疫情暴跌情景
- 自定义压力情景

#### 2.3.2 用户故事

**Story 5**: 作为风控经理，我想知道明天可能亏多少
- **场景**：看到"VaR(95%): -$2,300 (1.8%)"
- **价值**：心里有数，不会因为单日波动恐慌

**Story 6**: 作为交易员，我想避免黑天鹅事件
- **场景**：VaR突然飙升到5%，系统预警"风险超限"
- **价值**：及时减仓或对冲

#### 2.3.3 交互设计要点

**关键界面**：
```
┌─────────────────────────────────────────┐
│  风险实时监控                            │
├─────────────────────────────────────────┤
│  🎯 当前风险水位                         │
│                                          │
│  VaR(95%)     -$2,315  (1.82%)  🟢     │
│  CVaR(95%)    -$3,890  (3.05%)  🟡     │
│  最大回撤      -8.2%               🟢     │
│                                          │
│  📊 风险敞口分布                         │
│  ┌─────────────────────────────────┐   │
│  │ 科技  ████████████ 42%          │   │
│  │ 金融  ██████ 25%                │   │
│  │ 消费  ████ 18%                  │   │
│  │ 其他  ███ 15%                   │   │
│  └─────────────────────────────────┘   │
│                                          │
│  ⚠️ 警示: 科技板块集中度偏高,建议       │
│           分散至其他行业。               │
│                                          │
│  🔴 熔断规则: VaR > 3% 自动暂停交易    │
└─────────────────────────────────────────┘
```

**交互规则**：
- VaR仪表盘：实时更新（每小时）
- 压力测试按钮：一键运行情景分析
- 风险预警弹窗：VaR超限立即通知
- 历史VaR曲线：查看风险变化趋势

---

### 2.4 智能订单路由（IOR）

**功能价值**：降低执行成本，提高成交质量

#### 2.4.1 功能需求

**FR-10: 订单大小智能判断**
- 小单（<1% ADV）：市价单立即成交
- 中单（1-5% ADV）：限价单+60秒超时
- 大单（>5% ADV）：TWAP拆单（30分钟）

**FR-11: 执行成本估算**
- 买卖价差成本
- 市场冲击成本（Almgren-Chriss模型）
- 时机成本（Timing Risk）
- 预估总成本 vs 预期收益

**FR-12: 执行质量监控**
- 实际vs预期成本对比
- 成交率统计
- 平均滑点追踪
- VWAP偏离度

#### 2.4.2 用户故事

**Story 7**: 作为交易员，我不想因为大单把价格打下去
- **场景**：买1000股，系统自动拆成5个200股的订单，30分钟内分批执行
- **价值**：降低市场冲击，减少滑点

**Story 8**: 作为成本控制者，我想知道执行质量
- **场景**：看到"本周平均滑点0.08%，低于市场平均0.15%"
- **价值**：验证IOR系统有效性

#### 2.4.3 交互设计要点

**信号执行时的智能提示**：
```
┌─────────────────────────────────────────┐
│  准备执行信号: AAPL LONG 1000股         │
├─────────────────────────────────────────┤
│  💡 智能订单路由建议                     │
│                                          │
│  订单大小: 1000股                        │
│  日均成交量: 85M (占比: 0.001%)         │
│  → 建议策略: 市价单                      │
│                                          │
│  预估成本:                               │
│  • 买卖价差: $0.02 ($20)                │
│  • 市场冲击: $0.01 ($10)                │
│  • 总成本率: 0.02%                       │
│                                          │
│  预期收益: 5.2% vs 成本: 0.02%          │
│  → 成本收益比: ✅ 优秀 (260:1)          │
│                                          │
│  [确认执行]  [修改策略]  [取消]         │
└─────────────────────────────────────────┘
```

---

## 三、技术架构设计

### 3.1 后端架构

**新增服务**：
```
app/services/
  ├── benchmark_service.py       # 基准数据服务
  └── var_calculator.py          # VaR计算器

app/engine/
  ├── alpha_beta_calculator.py   # Alpha/Beta引擎
  ├── smart_order_router.py      # 智能订单路由
  └── performance_analyzer.py    # 增强性能分析（已有）

app/models/
  └── trading_signal.py          # 增加pnl_pct/is_winner字段
```

**数据流**：
```
[EquitySnapshot] → [PerformanceAnalyzer] → [Alpha/Beta Calculator]
                         ↓
                   [BenchmarkService] ← [Tiger API]
                         ↓
                   [Dashboard API] → [Frontend]
```

### 3.2 前端架构

**新增组件**：
```
src/components/
  ├── AlphaPerformancePanel.vue    # Alpha性能面板
  ├── SignalQualityDashboard.vue   # 信号质量仪表盘
  ├── VaRRiskMonitor.vue           # VaR风险监控
  └── SmartOrderExecutor.vue       # 智能订单执行器

src/api/
  └── performanceService.ts        # 性能指标API
```

### 3.3 数据模型扩展

**trading_signals 表新增字段**：
```sql
ALTER TABLE trading_signals 
ADD COLUMN pnl_pct DECIMAL(10, 6) COMMENT '盈亏百分比';

ALTER TABLE trading_signals 
ADD COLUMN is_winner VARCHAR(8) COMMENT 'YES/NO - 是否盈利';
```

---

## 四、用户体验设计原则

### 4.1 信息层次

**关键信息优先**：
1. Alpha（最重要）- 大字号、醒目颜色
2. Beta - 次要但重要
3. Sharpe/Info Ratio - 补充信息
4. 详细指标 - 可展开查看

### 4.2 可视化原则

**颜色语义**：
- 🟢 绿色：低风险、良好表现
- 🟡 黄色：中等风险、需关注
- 🔴 红色：高风险、警示
- ⚫ 黑色：账户数据
- ⚪ 灰色：基准数据
- 🟢 青色：超额收益（Active Return）

**图表选择**：
- Alpha/Beta：KPI卡片
- 收益对比：双折线图（账户+基准）
- 信号胜率：环形图+柱状图
- VaR分布：直方图+风险仪表盘
- 风险敞口：堆叠柱状图

### 4.3 交互反馈

**实时反馈**：
- 加载状态：骨架屏（Skeleton）
- 数据更新：平滑过渡动画
- 用户操作：即时视觉反馈

**错误处理**：
- 数据不足：友好提示 + 最少数据要求说明
- 计算失败：降级方案（显示基础指标）
- 网络错误：自动重试 + 错误提示

---

## 五、性能与安全

### 5.1 性能要求

- Alpha/Beta计算：< 500ms
- 信号胜率查询：< 300ms
- VaR实时计算：< 1s
- Dashboard首屏加载：< 2s

### 5.2 缓存策略

- 基准数据：缓存1小时
- Alpha/Beta：缓存5分钟（交易时段）
- 信号胜率：缓存15分钟
- VaR：缓存30分钟

### 5.3 安全考虑

- Alpha/Beta数据权限校验
- 敏感指标脱敏处理
- 审计日志记录

---

## 六、上线计划

### 6.1 MVP范围（第1周）

**P0功能**：
- [x] Alpha/Beta计算引擎
- [x] 信号胜率追踪
- [x] 基础Dashboard展示
- [ ] 多策略信号融合（已实现）

**验收标准**：
- 能准确计算Alpha和Beta
- 能展示信号胜率统计
- Dashboard能正常显示

### 6.2 完整版（第2-4周）

**P1功能**：
- VaR/CVaR计算
- 智能订单路由
- 压力测试
- 完整UI交互

### 6.3 高级版（第2-3月）

**战略功能**：
- 回测引擎
- A/B测试框架
- ML信号增强
- 自动化周报

---

## 七、成功指标（KPI）

### 7.1 产品指标

- **用户参与度**：
  - Alpha面板日均查看次数 > 10次
  - 信号质量仪表盘使用率 > 80%
  
- **功能采纳度**：
  - VaR监控启用率 > 70%
  - 智能订单路由使用率 > 60%

### 7.2 业务指标

- **交易表现**：
  - Alpha(vs SPY) ≥ 5% 年化
  - 信号胜率 ≥ 55%
  - Sharpe Ratio ≥ 1.5
  
- **风险控制**：
  - VaR(95%) < 2%
  - 最大回撤 < 15%
  - 无风险超限事件

---

## 八、风险与挑战

### 8.1 技术风险

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| 基准数据获取失败 | 高 | 模拟数据降级方案 |
| Alpha计算偏差 | 中 | 多种算法交叉验证 |
| VaR计算耗时 | 低 | 异步计算+缓存 |

### 8.2 产品风险

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| 用户不理解Alpha概念 | 中 | 加入解释性说明 |
| 数据展示过于复杂 | 中 | 分层展示，默认简化 |
| 性能指标波动大 | 低 | 平滑处理+趋势线 |

---

## 九、附录

### 9.1 术语表

- **Alpha**: 超额收益，投资组合相对基准的主动回报
- **Beta**: 系统性风险，投资组合相对市场的波动性
- **Sharpe Ratio**: 每单位风险获得的超额收益
- **VaR**: Value at Risk，在险价值
- **CVaR**: Conditional VaR，条件在险价值（尾部风险）
- **ADV**: Average Daily Volume，日均成交量
- **TWAP**: Time-Weighted Average Price，时间加权平均价

### 9.2 参考文献

- CAPM模型：Sharpe (1964)
- Almgren-Chriss执行成本模型 (2000)
- VaR计算方法：J.P. Morgan RiskMetrics

---

**签署确认**：

产品经理：_________  
技术负责人：_________  
日期：2026-02-13
