# 产品需求文档 (PRD)

> **AI量化交易闭环系统** - 个人美港股智能交易平台  
> 版本：V9.0 | 更新日期：2026-02-13

---

## 1. 产品愿景

从华尔街量化交易视角打造个人级 AI 交易系统，实现从研判到执行、从监控到复盘的完整交易闭环。

### 1.1 核心理念

**Alpha Loop（阿尔法闭环）**：  
研判 → 计划 → 信号 → 执行 → 归因 → 复盘 → 改进 → 研判

### 1.2 北极星指标

| 指标 | 目标 |
|------|------|
| 交易闭环覆盖 | 100% |
| 日常操作步数 | ≤ 5 步 |
| 信号到通知延迟 | < 3s |
| 计划执行率 | ≥ 80% |
| 系统可用性 | ≥ 99.5% |

---

## 2. 用户画像

### 2.1 目标用户

- **个人交易者**（美股+港股）
- 1-3 年交易经验，追求系统化管理
- 日均操作时间 < 30 分钟
- 使用 Tiger/富途等互联网券商

### 2.2 核心痛点

1. **信息过载**：市场数据太多，难以快速决策
2. **执行拖延**：有想法但缺乏系统化执行工具
3. **复盘困难**：交易记录零散，缺乏系统性总结
4. **风险失控**：凭感觉交易，缺乏量化风控
5. **情绪交易**：追涨杀跌，缺乏纪律约束

---

## 3. 系统功能架构

### 3.1 交易闭环 9 阶段

```
① Research (研究分析)
    ↓ 策略引擎运行
② Signal Generation (信号生成)
    ↓ 信号引擎筛选
③ Signal Validation (信号验证)
    ↓ 风险检查通过
④ Execution (订单执行)
    ↓ 真实下单
⑤ Monitoring (持续监控)
    ↓ 实时跟踪
⑥ Evaluation (性能评估)
    ↓ 每日统计
⑦ Feedback (反馈识别)
    ↓ 模式识别
⑧ Adaptive Optimization (自适应优化)
    ↓ 参数调整
⑨ Loop (循环迭代)
    → 回到 ① 自我进化
```

### 3.2 核心模块

#### A. 研究与分析
- **市场热点分析**：识别热门赛道和个股
- **宏观风险评分**：地缘政治+经济指标综合判断
- **技术面分析**：多指标技术分析
- **基本面分析**：估值+成长性评估
- **K线形态识别**：AI 驱动的走势预判

#### B. 信号与计划
- **策略库管理**：12大类量化策略（均值回归/趋势跟踪/多因子/防御/波动率/宏观对冲）
- **策略筛选引擎**：多因子选股 + 策略运行
- **AI 交易决策**：综合研判给出交易建议
- **交易计划管理**：计划创建、执行、监控

#### C. 执行与监控
- **订单执行引擎**：自动/手动下单
- **价格告警系统**：条件触发推送
- **持仓评估**：实时 Greeks + 风险监控
- **实时推送**：WebSocket + Telegram 通知

#### D. 复盘与优化
- **交易日志**：记录决策过程和结果
- **资金曲线**：净值走势 + 最大回撤
- **行为评分**：识别交易坏习惯（追高、卖飞等）
- **AI 自动复盘**：分析交易质量提供改进建议

---

## 4. 核心功能详述

### 4.1 Dashboard（交易仪表盘）

**功能价值**：一屏全览账户状态和核心指标

**关键指标**：
- 总权益 + 今日盈亏 + MTD/YTD 收益率
- Greeks 水位（Delta/Gamma/Vega/Theta）
- 待执行计划 + 执行率
- 风险等级（LOW/MEDIUM/HIGH）
- 实时信号推送

### 4.2 AI 交易决策

**输入**：
- 用户指定标的（如 AAPL, TSLA）
- 当前账户权益与持仓

**AI 决策维度**：
1. **技术面评分**：趋势强度 + RSI + MACD + 支撑阻力
2. **基本面评分**：PE/PS + 增长率 + ROE
3. **K线走势分析**：AI 判断短期方向
4. **风险收益比**：止损/止盈/入场价计算
5. **情景分析**：牛市/熊市/中性概率分布

**输出**：
```json
{
  "direction": "LONG/SHORT/NEUTRAL",
  "confidence": 0-100,
  "action": "BUY/SELL/HOLD/AVOID",
  "entry_price": 123.45,
  "stop_loss": 120.00,
  "take_profit": 130.00,
  "position_pct": 0.15,
  "risk_level": "MEDIUM",
  "reasoning": "多维信号综合判断...",
  "scenarios": { "bull": {...}, "bear": {...} }
}
```

**决策原则**：
- 风险收益比 < 1:2 → 建议 HOLD/AVOID
- 置信度 < 60% → 强制 HOLD
- 单标的仓位 ≤ 30%

### 4.3 交易计划

**生命周期**：
```
PENDING → ACTIVE → EXECUTED/CANCELLED/EXPIRED/FAILED
```

**计划类型**：
- **AI 建议计划**：基于 AI 决策生成
- **手动计划**：用户自定义

**执行模式**：
- **自动执行**：符合条件直接下单
- **半自动**：推送通知，用户确认后执行
- **手动**：仅作为备忘，不自动执行

### 4.4 策略库管理

**功能价值**：提供华尔街级别的量化策略库，覆盖全市场环境

**策略分类**：

#### A. 均值回归策略 (Mean Reversion)
1. **布林带均值回归** - 价格偏离均线 > 2σ 时回归
2. **配对交易** - 协整股票对价差交易

#### B. 趋势跟踪策略 (Trend Following)
3. **突破动量** - 突破关键阻力/支撑位
4. **黄金交叉** - 短期均线上穿长期均线

#### C. 多因子策略 (Multi-Factor)
5. **Fama-French 三因子** - 市场/规模/价值因子
6. **动量+质量** - ROE + 价格动量综合

#### D. 防御策略 (Defensive)
7. **低波动率** - 选择历史波动率最低标的
8. **尾部对冲** - 自动购买虚值看跌期权

#### E. 波动率策略 (Volatility)
9. **铁鹰期权** - 卖出跨式+保护腿
10. **波动率套利** - 隐含波动率 vs 历史波动率

#### F. 宏观对冲策略 (Macro Hedge)
11. **行业轮动** - 经济周期驱动的板块切换
12. **CTA 商品** - 商品期货趋势跟踪

**策略参数**：
- 每个策略支持自定义参数（时间窗口/阈值/权重）
- 默认参数基于华尔街实践优化
- 支持参数回测和自适应优化

**策略运行**：
- 定时扫描：每日盘前/盘中/盘后
- 手动触发：用户主动运行
- 批量运行：多策略并行执行

**信号生成**：
- 策略运行生成交易信号
- 信号包含：标的/方向/强度/权重/风险评分
- 自动过滤：风险检查 + 持仓限制

### 4.5 信号引擎

**信号来源**：
- **策略运行结果**：12大类策略产生的因子驱动信号
- AI 交易决策
- 价格告警触发

**信号状态**：
```
PENDING → VALIDATED → EXECUTED/CANCELLED/EXPIRED/FAILED
```

**风险过滤**：
- 单标的持仓限制
- Greeks 水位检查
- 最大回撤保护
- 日内交易次数限制

### 4.6 行为评分

**识别模式**：
- **卖飞（Sell Fly）**：卖出后继续大涨
- **追高（Chase High）**：买入后立即下跌
- **止损不果断**：亏损扩大不及时止损
- **频繁交易**：日内过度交易

**评分维度**（0-100）**：
- 纪律性评分（Discipline）
- 卖飞评分（反向，越低越好）
- 整体行为健康度

### 4.7 价格告警

**触发条件**：
- 价格突破/跌破某值
- 涨跌幅达到 X%
- 技术指标触发（如 MACD 金叉）

**响应动作**：
- WebSocket 实时推送
- Telegram 机器人通知
- 触发交易计划（可选）

---

## 5. 技术要求

### 5.1 性能指标

| 指标 | 要求 |
|------|------|
| API 响应时间 | P95 < 500ms |
| Dashboard 刷新 | ≤ 30s |
| WebSocket 延迟 | < 1s |
| 系统可用性 | ≥ 99.5% |

### 5.2 安全要求

- JWT 认证 + bcrypt 密码加密
- API Rate Limit（100 req/min）
- 敏感操作审计日志
- 券商 API Key 安全存储

### 5.3 数据要求

- 账户权益每日快照
- 交易日志完整记录
- 持仓数据实时同步（30s 轮询）
- 技术指标缓存 1 小时

---

## 6. 成功标准

### 6.1 功能完整性

- ✅ 9 阶段交易闭环全覆盖
- ✅ AI 决策引擎上线
- ✅ 自动执行引擎稳定运行
- ✅ 复盘系统可用
- ✅ 实时推送功能

### 6.2 用户体验

- 日常核心操作 ≤ 5 步
- Dashboard 一屏即可完成核心决策
- 移动端响应式适配
- 深色终端风格一致

### 6.3 业务指标

- 计划执行率 ≥ 80%
- AI 决策胜率 ≥ 55%
- 用户留存率 ≥ 90% (30天)
- 平均日活时长 < 30 分钟

---

## 7. 路线图

### Phase 1: 核心闭环（已完成 ✅）
- 信号引擎 + 订单执行
- Dashboard V1
- 交易计划管理
- 行为评分

### Phase 2: AI 增强（已完成 ✅）
- AI 交易决策
- 评估历史管理
- Dashboard V2 重构
- 多维分析整合

### Phase 3: 实时化（进行中）
- WebSocket 推送
- 价格告警系统
- Telegram 集成
- 实时资金曲线

### Phase 4: 策略库扩充（进行中）
- 12大类量化策略实现
- Phase 1 核心策略（3个）
  - 布林带均值回归
  - 低波动率防御
  - Fama-French 三因子
- Phase 2 进阶策略（3个）
  - 突破动量
  - 行业轮动
  - 配对交易
- Phase 3 高级策略（6个）
  - 黄金交叉、动量+质量、尾部对冲
  - 铁鹰期权、波动率套利、CTA商品

### Phase 5: 智能化
- 自适应参数优化
- 模式识别与学习
- 交易助手对话
- 策略自动调优

---

## 附录

### A. 术语表

| 术语 | 定义 |
|------|------|
| Alpha Loop | 完整交易闭环流程 |
| Greeks | 期权风险指标（Delta/Gamma/Vega/Theta） |
| R:R | Risk-Reward Ratio（风险收益比） |
| Sell Fly | 卖出后股价继续上涨的行为 |
| Chase High | 追涨买入后立即下跌 |

### B. 参考文档

- API.md - 接口文档
- BACKEND_DESIGN.md - 后端架构设计
- FRONTEND_DESIGN.md - 前端 UI/UX 设计
